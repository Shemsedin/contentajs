<!--
  This file was generated by emdaer

  Its template can be found at .emdaer/README.emdaer.md
-->

<!--
  emdaerHash:7bc77c82cad4e2515f05d350a160d660
-->

<h1 id="contentajs-img-align-right-src-logo-svg-alt-contenta-logo-title-contenta-logo-width-100-">ContentaJS <img align="right" src="./logo.svg" alt="Contenta logo" title="Contenta logo" width="100"></h1>
<p>ContentaJS is a project that integrates with Contenta CMS to provide
an ultra high performing headless CMS. It also provides a nodejs application
where to host your Server Side Rendering and custom code integrations.</p>
<p align="center"><img src="./.emdaer/docs/assets/contentacms-node.png" alt="Contenta Stack Architecture"></p>

<p><strong>IMPORTANT:</strong> this project is meant to be a starting kit for the node
integration of your application based on Contenta CMS. We <strong>do not</strong> provide
upgrade paths or backwards compatibility. The model for this is <em>Fork &amp; Go</em>.</p>
<!-- toc -->
<ul>
<li><a href="#why">Why?</a><ul>
<li><a href="#microservices">Microservices</a></li>
<li><a href="#server-side-rendering">Server-Side Rendering</a></li>
<li><a href="#performance">Performance</a></li>
<li><a href="#other">Other</a></li>
</ul>
</li>
<li><a href="#features">Features</a></li>
<li><a href="#installation">Installation</a><ul>
<li><a href="#local-installation">Local Installation</a></li>
<li><a href="#aws-installation">AWS Installation</a></li>
<li><a href="#install-using-docker">Install Using Docker</a></li>
</ul>
</li>
<li><a href="#internal-development-notes">Internal Development Notes</a></li>
<li><a href="#contributors">Contributors</a></li>
<li><a href="#license">License</a></li>
</ul>
<!-- tocstop -->
<p><a href="https://travis-ci.org/contentacms/contentajs/"><img src="https://img.shields.io/travis/contentacms/contentajs.svg?style=flat-square" alt="Travis"></a> <a href="https://coveralls.io/github/contentacms/contentajs/"><img src="https://img.shields.io/coveralls/github/contentacms/contentajs.svg?style=flat-square" alt="Coverage"></a> <a href="https://github.com/emdaer/emdaer"><img src="https://img.shields.io/badge/ðŸ““-documented%20with%20emdaer-F06632.svg?style=flat-square" alt="Documented with emdaer"></a></p>
<h2 id="why-">Why?</h2>
<p><strong>Contenta CMS</strong> (aka <em>the Drupal part</em>) is designed to serve your projectâ€™s
content. ContentaJS (aka <em>the node.js part</em>) is designed to serve the requests
to your client side applications. Some of those requests will end up requesting
data from Contenta CMS, others wonâ€™t.</p>
<p>You may need <strong>ContentaJS</strong> because for many reasons <strong>you will end up needing a
node.js server for your project anyways</strong>. You may as well use an opinionated
and optimized starter kit that will solve many of your needs without effort.</p>
<h3 id="microservices">Microservices</h3>
<p>If your API needs to aggregate data for use on the front-end from other services
you <strong>should not</strong> use PHP for that. That is because, in practice, all I/O in
Drupal is blocking and the performance of these tasks is usually very poor.</p>
<p>An example of this would be if you are showing weather data from a 3rd party
API. Another example is if you need to make requests to an analytics tool.
Another example is if you need to run a request through an anti-fraud service
before accessing the content.</p>
<p>In these situations you will want to treat <strong>Contenta CMS</strong> just as any other
microservice. Then you will need a server, like this one written in node.js, to
orchestrate the different microservices.</p>
<h3 id="server-side-rendering">Server-Side Rendering</h3>
<p>Chances are that you are building a website as part of your digital project. In
most cases you will be using a front-end framework like React, Vue, Angular,
etc. All of those frameworks recommend using server-side rendering
<a href="https://ssr.vuejs.org/#why-ssr">for many reasons</a>. In order to implement
server-side rendering you will need a node.js server.</p>
<p>You can use this node.js server (aka <em>ContentaJS</em>) to implement server-side
rendering on.</p>
<h3 id="performance">Performance</h3>
<p>Your LAMP stack (or alternative) runs your Contenta CMS installation. We all
know how flexible and powerful Drupal is. But at the same time it is not great
from a performance point of view. In fact it can rapidly become your bottleneck.</p>
<p>With ContentaJS you can reduce the load in your LAMP stack. This is because you
donâ€™t even need to hit this stack to access cached responses. ContentaJS will
fetch the data from cache, and will only check with Drupal when there is no
cache. That reduces greatly the amount of requests Apache needs to process. This
reduces the load on Drupal, hence improving performance overall.</p>
<p>ContentaJS integrates transparently with Contenta CMS and can analyze requests
that will fail in Drupal. When that happens the request never hits Drupal thus
reducing the load there. Examples of this are: a request to a non-existing
resource, a request that contains a payload that doesnâ€™t validate against the
schema of the resource, etc.</p>
<h3 id="other">Other</h3>
<p>Other server tasks like executing actions on cron, or sending emails, etc. can
be done in this node.js server (and/or the machine running it) instead of on
the LAMP stack.</p>
<h2 id="features">Features</h2>
<p><em>This section is still under development.</em></p>
<p>The main features of this project cover:</p>
<ul>
<li>Automatic integration with the API exposed by your Contenta CMS install.
Just provide the URL of the site and everything is taken care of for you.</li>
<li>Multi-threaded nodejs server that takes advantage of all the cores of the
serverâ€™s CPU.</li>
<li>A Subrequests server for request aggregation. Learn more about <a href="./.emdaer/docs/subrequests.md">subrequests</a>.</li>
<li>A <a href="http://redis.io">Redis</a> integration. This comes with a connection pool to
eliminate latency obtaining connections with the server.</li>
<li>Type safe development environment using <a href="http://flow.org">Flow</a>.</li>
<li><a href="https://github.com/contentacms/contentajs/blob/master/config/default.yml#L66-L85">Configurable CORS</a>.</li>
</ul>
<h2 id="installation">Installation</h2>
<p>In order to install ContentaJS you will need to meet the following requirements:</p>
<ul>
<li><code>nodejs</code> ^8.11.1 or higher.</li>
<li>A working installation of <a href="https://github.com/contentacms/contenta_jsonapi">Contenta CMS</a>.<ul>
<li>You should enable the <em>Contenta Redis</em> optional module.</li>
<li>You should configure the connection from Drupal to Redis according to the instructions <a href="https://cgit.drupalcode.org/redis/tree/README.Predis.txt">here</a>.</li>
</ul>
</li>
<li>A Redis server.</li>
</ul>
<h3 id="local-installation">Local Installation</h3>
<p><em>Fill in the instructions on how to install locally</em></p>
<h3 id="aws-installation">AWS Installation</h3>
<p><em>Fill in the instructions on how to install in AWS with ElastiCache using CloudFormation or a custom AMI</em></p>
<h3 id="install-using-docker">Install Using Docker</h3>
<p><em>Fill in the instructions on how to install using Docker.</em></p>
<p><em>Ideally this installs Contenta CMS (Drupal), ContentaJS, and the Redis server.</em></p>
<h2 id="internal-development-notes">Internal Development Notes</h2>
<p><em>This is a dumping ground of notes. This section will disappear eventually, itâ€™s
just meant to save ideas for documentation to process some other time.</em></p>
<ul>
<li>Mention that both Drupal and node need to talk to the same Redis server.</li>
<li>Make it clear that this is a starting point. To this node install you can:
proxy to other microservices, add server side rendering, etc.</li>
<li>Server side rendering can be added as a package / middleware.</li>
<li>Introduce the ability to timeout requests.</li>
<li>Create a separate package using passport to integrate with Simple OAuth.</li>
<li>Make CORS customizable from configuration.</li>
<li>If all subrequests are to the CMS forward the blueprint to Drupalâ€™s subrequests.</li>
<li>Make Flow types nicer in the middlewares.</li>
<li>Fix the link in the responses from Contenta CMS.</li>
<li>Validate the request bodies before reaching the CMS using the resource schemas.</li>
<li>Filter requests that the CMS should not be bothered with using the resource lists.</li>
<li>Make sure to mention that the /healthckeck is for auto-scaling policies.</li>
<li>Create @contentacms/â€¦ submodules for logging interfaces like Splunk.</li>
</ul>
<h2 id="contributors">Contributors</h2>
<details>
<summary><strong>Contributors</strong></summary><br>
<a title="Engineer and programmer focused on online applications." href="https://github.com/e0ipso">
  <img align="left" src="https://avatars0.githubusercontent.com/u/1140906?s=24">
</a>
<strong>Mateu AguilÃ³ Bosch</strong>
<br><br>
</details>

<h2 id="license">License</h2>
<p>@contentacms/contentajs is <a href="./LICENSE">MIT licensed</a>.</p>
